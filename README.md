# Building a Managed COM Class With an Embedded Type Library

Writing managed code to distribute with Microsoft Office applications is difficult.  This project aims to produce an example that will make such an endeavor easier.

Another feature of this project is that it contains a static method to instantiate the object.  This makes it easier to use with VBA, because the COM will not need to be registered with the operating system in order to be used.  It also will not require a SxS manifest, used with an .EXE, which is also problematic for non-administrative users since the manifest would need to live either embedded in the EXE itself, or in the same folder as the Office executable.

## Steps for Visual Studio 2015:

1. Create a blank solution
2. Create a blank Win32 project, with static library as the target type
   1. Right-click the project, and choose Properties
   2. Choose All Platforms under Platform
      1. In General settings, set both Output and Intermediate directories to ```$(ProjectDir)output\```
      2. In Build Events->Post Build Event, enter:
	  ```
		tlbimp "$(IntDir)$(ProjectName).tlb" /out:"$(IntDir)$(ProjectName).dll" /namespace:ComLib
	  ```
	  Choose a namespace appropriate for your project.  ```tlbimp``` will generate a managed DLL based on the .tlb file created by the .idl
3. Add a new blank .idl file to the project.  We will use this file to define the COM object's interface, and we'll also use it to define the managed object's interface.
4. Add a module to your .idl file, with a method called CreateObject (or choose a name), which returns an instance of a dispinterface defined in your MIDL
5. Implement the interface in the .idl file
6. Build the project
7. Create a new .NET managed library (.dll)
8. Add a reference to the .dll file that was generated by the unmanaged build project
9. Create a public class, derived from a ```dispinterface``` you have defined in your .idl file
10. Use NuGet to add a reference to UnmanagedExports by Robert Giesecke
	1. Add using ```RGiesecke.DllExport;``` to the file that contains your COM class
    2. Decorate a static function called CreateObject in your COM class with ```[DllExport("CreateObject", CallingConvention = CallingConvention.StdCall)]```
11. Ensure that all projects are configured as x86 or x64.  This is important, becuase the static export will not work with AnyCPU

You should be able to add a reference in Office to the managed DLL.


